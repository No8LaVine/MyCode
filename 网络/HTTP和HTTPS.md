## HTTP & HTTPS

### HTTP

~~~
超文本传输协议，用于在 Web 浏览器和网站服务器之间传递信息。
~~~

### HTTPS

~~~
是以安全为目标的HTTP通道，简单讲是HTTP的安全版，即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。
~~~

##### 主要作用

~~~
HTTPS协议的主要作用可以分为两种：一种是建立一个信息安全通道，来保证数据传输的安全；另一种就是确认网站的真实性。
~~~

### 区别

~~~
1、https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。

2、http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。

3、http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。

4、http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。
~~~

### HTTPS详解

##### 对称加密

~~~
就是加密和解密都是用同一个秘钥

~~~

**常见对称加密算法**

~~~
AES、DES、3DES、TDEA、Blowfish、RC4、RC5、IDEA
~~~

**优点**

>算法公开、计算量小、加密速度快、加密效率高，适合加密比较大的数据。

**缺点**

>1. 交易双方需要使用相同的密钥，也就无法避免密钥的传输，而密钥在传输过程中无法保证不被截获，因此对称加密的安全性得不到保证
>
>   
>
>2. 每对用户每次使用对称加密算法时，都需要使用其他人不知道的惟一密钥，这会使得发收信双方所拥有的钥匙数量急剧增长，密钥管理成为双方的负担。对称加密算法在分布式网络系统上使用较为困难，主要是因为密钥管理困难，使用成本较高。
>
>

##### 非对称加密算法

~~~
非对称加密有一个秘钥对，叫做公钥和私钥，私钥自己持有，公钥可以公开的发送给使用的人。使用公钥进行加密的信息，只有和其配对的私钥可以解开。目前
常见的非对称加密算法是RSA，非对称的加密算法的优点是安全，因为他不需要把私钥暴露出去。

在正式的使用场景中一般都是对称加密和非对称加密结合使用，使用非对称加密完成秘钥的传递，然后使用对称秘钥进行数据加密和解密
~~~

##### HTTPS建立连接的过程

##### 最初方案

**对称加密**

用来加密解密的钥匙只有一个,且必定会在传输过程中携带，被截获后相当于不加密。

##### 进阶方案

**注**：公钥所有客户端都可以获取，私钥只有服务端有。**对称加密 + 非对称加密**（服务端存有公钥+私钥）

**公钥加密，私钥解密**

**客户端——服务端**

> 1. 客户端向服务端发起请求
> 2. 服务端返回公钥给客户端
> 3. 客户端用公钥对数据加密
> 4. 将加密过的数据发送给服务端
> 5. 服务端用私钥解析数据

**缺点**

假如，服务端主动发起连接，发送了用私钥加密过的数据，但问题是黑客也可以获取到公钥对其进行解密。

##### 再进阶方案

在进阶方案的基础上，加了一个key

> 1. 客户端向服务端发起请求
> 2. 服务端返回公钥给客户端
> 3. 客户端用公钥对key加密
> 4. 将加密过的key发送给服务端
> 5. 服务端用私钥解析key
> 6. 客户端和服务端用这个key对称加密进行数据传输

**不是绝对安全，中间人攻击有可能发生**

##### 中间人攻击

黑客（中间人）伪装成服务端，自己有一份公钥和私钥，客户端在请求连接的时候即被中间人拦截，把自己的公钥发给客户端，再用客户端的数据向服务端请求得到真正的公钥，由此，客户端后绪发来的数据都被中间人以自己的私钥破解，修改或记录数据后再用服务端给的真正的公钥去向服务端发起请求。

**解决**

最终方案中已经给出，即CA证书，客户端本地存了用来验证CA证书的`key`，即使中间人截获了信息，并伪装服务端发送证书，但必定会证书验证不合法。

##### 最终方案

**对称加密 + 非对称加密 + CA证书 + hsah** 

>1）客户端发起一个http请求，连接到服务器的443端口，客户端会携带SSL版本，支持的非对称加密算法和hash算法，随机数。
>
>2）服务端把自己的信息以CA证书的形式返回给客户端（证书内容有密钥公钥，网站地址，证书颁发机构，失效日期，hash算法等）。证书中有一个**公钥**来加密信息，私钥由服务器持有。
>
>3）验证证书的合法性
>
>客户端收到服务器的响应后会先验证证书的合法性（证书中包含的地址与正在访问的地址是否一致，证书是否过期）。
>
>4）生成随机密码（RSA签名）
>
>​	**随机数**：如果验证通过，或用户接受了不受信任的证书，浏览器就会生成一个随机的对称密钥（session key）并**用公钥加密**，让**服务端用私钥解密**，解密				   后就用这个**随机数**进行传输了，并且能够说明服务端确实是私钥的持有者。
>
>​	**hash握手信息：**用最开始约定好的hash方式，把握手消息取hash值， 然后用 随机数加密 “握手消息+握手消息hash值(签名)” 并一起发送给服务端，在							    这里之所以要取握手消息的hash值，主要是把握手消息做一个签名，用于验证握手消息在传输过程中没有被篡改过。
>
>5) 服务端拿到客户端发送来的密文，用自己的私钥破解密文，取出随机数密码，再用随机数密码 解密 握手消息与hash值，并与传过来的hash值做对比确认是否一致。然后用随机密码加密一段握手消息(握手消息+握手消息的hash值 )给客户端
>
>6）客户端用随机数解密并计算握手消息的HASH，如果与服务端发来的HASH一致，此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密
>
>5）生成对称加密算法
>
>验证完服务端身份后，客户端生成一个对称加密的算法和对应密钥，以公钥加密之后发送给服务端。此时被黑客截获也没用，因为只有服务端的私钥才可以对其进行解密。之后客户端与服务端可以用这个对称加密算法来加密和解密通信内容了。

##### CA证书有三个作用

>1、身份授权。确保浏览器访问的网站是经过CA验证的可信任的网站。
>
>2、分发公钥。每个数字证书都包含了注册者生成的公钥（**验证确保是合法的，非伪造的公钥**）。在SSL握手时会通过**certificate消息**传输给客户端。
>
>3、验证证书合法性。客户端接收到数字证书后，会对证书合法性进行验证。只有验证通过后的证书，才能够进行后续通信过程。



真牛：

https://www.bilibili.com/video/BV1w4411m7GL

参考：

https://www.shuzhiduo.com/A/KE5QwkPjzL/

https://segmentfault.com/a/1190000021494676

https://zhuanlan.zhihu.com/p/60033345

https://zhuanlan.zhihu.com/p/107573461

https://wetest.qq.com/lab/view/110.html